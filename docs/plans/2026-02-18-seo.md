# SEO — Plan de Implementación

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Corregir dos gaps SEO confirmados: meta `og:image:alt` y `twitter:image:alt` ausentes en todas las páginas, y canonical self-referencing en páginas paginadas > 1 (que ya tienen `noindex` pero sin canonical explícito a la página raíz).

**Architecture:** Task 1 modifica solo `BaseLayout.astro` (2 líneas). Task 2 añade una prop `canonicalOverride` a `BaseLayout.astro` y la usa en `blog/[...page].astro` y `categorias/[category]/[...page].astro`. Sin dependencias externas.

**Tech Stack:** Astro 5, Open Graph protocol, Twitter Cards

**Nota previa al implementador:** Las páginas de categoría, tag y autor YA tienen `description` bien configurada — no hay que tocar eso. Las páginas paginadas > 1 YA tienen `noindex` — el canonical es una capa adicional de robustez.

---

## Task 1: Añadir `og:image:alt` y `twitter:image:alt`

Los metadatos Open Graph y Twitter Cards del blog no incluyen alt text para la imagen de preview. Meta/Facebook y Twitter recomiendan este atributo para accesibilidad de las tarjetas compartidas.

**Files:**

- Modify: `src/layouts/BaseLayout.astro:68-80`

**Step 1: Leer el bloque de Open Graph y Twitter Cards actual**

```bash
grep -n "og:image\|twitter:image" src/layouts/BaseLayout.astro
```

Expected: ver `og:image`, `og:image:width`, `og:image:height` sin `og:image:alt`, y `twitter:image` sin `twitter:image:alt`.

**Step 2: Añadir `og:image:alt` tras `og:image:height`**

Localizar en `src/layouts/BaseLayout.astro` este bloque (aproximadamente líneas 68-72):

```html
<meta property="og:image" content="{imageURL}" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:locale" content="es_ES" />
```

Insertar `og:image:alt` entre `og:image:height` y `og:locale`:

```html
<meta property="og:image" content="{imageURL}" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content="{description}" />
<meta property="og:locale" content="es_ES" />
```

**Step 3: Añadir `twitter:image:alt` tras `twitter:image`**

Localizar (aproximadamente línea 80):

```html
<meta name="twitter:image" content="{imageURL}" />
```

Insertar justo después:

```html
<meta name="twitter:image" content="{imageURL}" />
<meta name="twitter:image:alt" content="{description}" />
```

**Step 4: Verificar lint y build**

```bash
cd /home/antonio/Documentos/blog && npm run lint && npm run build 2>&1 | tail -5
```

Expected: lint 0 errores, build sin errores.

**Step 5: Verificar en el HTML generado**

```bash
grep -r "og:image:alt\|twitter:image:alt" dist/index.html | head -4
```

Expected: dos líneas con los nuevos meta tags.

**Step 6: Commit**

```bash
git add src/layouts/BaseLayout.astro
git commit -m "seo: añadir og:image:alt y twitter:image:alt en BaseLayout"
```

---

## Task 2: Canonical explícito en páginas paginadas > 1

Las páginas `/blog/2/`, `/blog/3/` y `/categorias/linux/2/` etc. ya tienen `noindex`, pero su `<link rel="canonical">` apunta a sí mismas (self-referencing). Añadir canonical explícito apuntando a la página 1 refuerza la señal para crawlers: "la versión indexable es la página raíz".

**Files:**

- Modify: `src/layouts/BaseLayout.astro` (añadir prop `canonicalOverride`)
- Modify: `src/pages/blog/[...page].astro`
- Modify: `src/pages/categorias/[category]/[...page].astro`

**Step 1: Leer los tres archivos**

```bash
grep -n "canonicalURL\|canonicalOverride\|interface Props\|noindex" \
  src/layouts/BaseLayout.astro \
  src/pages/blog/[...page].astro \
  src/pages/categorias/[category]/[...page].astro
```

Confirmar que `BaseLayout` no tiene `canonicalOverride` aún.

**Step 2: Añadir prop `canonicalOverride` a BaseLayout**

En `src/layouts/BaseLayout.astro`:

2a. Añadir `canonicalOverride?: string;` a la interfaz `Props` (junto a las demás props, por ejemplo después de `noindex?`):

```typescript
interface Props {
  title?: string;
  description?: string;
  image?: string;
  article?: boolean;
  publishDate?: string;
  modifiedDate?: string;
  author?: string;
  noindex?: boolean;
  isHome?: boolean;
  canonicalOverride?: string;
}
```

2b. Añadir `canonicalOverride` a la desestructuración de `Astro.props`:

```typescript
const {
  title = site.title,
  description = site.description,
  image = '/images/og-default.png',
  article = false,
  publishDate,
  modifiedDate,
  author,
  noindex = false,
  isHome = false,
  canonicalOverride,
} = Astro.props;
```

2c. Cambiar la línea que calcula `canonicalURL` (actualmente `const canonicalURL = new URL(Astro.url.pathname, Astro.site);`) por:

```typescript
const canonicalURL = canonicalOverride
  ? new URL(canonicalOverride, Astro.site)
  : new URL(Astro.url.pathname, Astro.site);
```

**Step 3: Actualizar `blog/[...page].astro`**

En `src/pages/blog/[...page].astro`, el `<BaseLayout ...>` actualmente es:

```astro
<BaseLayout
  title="Blog"
  description="Todos los artículos del blog"
  noindex={page.currentPage > 1}
/>
```

Cambiarlo a:

```astro
<BaseLayout
  title="Blog"
  description="Todos los artículos del blog"
  noindex={page.currentPage > 1}
  canonicalOverride={page.currentPage > 1 ? '/blog/' : undefined}
/>
```

**Step 4: Actualizar `categorias/[category]/[...page].astro`**

En `src/pages/categorias/[category]/[...page].astro`, el `<BaseLayout ...>` actualmente es:

```astro
<BaseLayout
  title={`Categoría: ${category}`}
  description={meta?.description ?? `Artículos sobre ${category}`}
  noindex={page.currentPage > 1}
/>
```

Cambiarlo a (nota: `basePath` ya está calculado como `const basePath = \`/categorias/${slugify(category)}\`;`):

```astro
<BaseLayout
  title={`Categoría: ${category}`}
  description={meta?.description ?? `Artículos sobre ${category}`}
  noindex={page.currentPage > 1}
  canonicalOverride={page.currentPage > 1 ? `${basePath}/` : undefined}
/>
```

**Step 5: Verificar TypeScript y lint**

```bash
cd /home/antonio/Documentos/blog && npx astro check 2>&1 | grep -E "error" | grep -v hint
npm run lint
```

Expected: 0 errores en ambos.

**Step 6: Verificar build y HTML generado**

```bash
npm run build 2>&1 | tail -5

# Para blog page 2 (si existe):
grep -r "canonical" dist/blog/2/index.html 2>/dev/null || echo "no page 2 or check dist/blog/"

# Para categorías (ajustar según categorías reales):
ls dist/categorias/ | head -5
```

Expected: en la página 2 del blog, el canonical debería apuntar a la URL del blog (página 1), no a `/blog/2/`.

**Step 7: Commit**

```bash
git add src/layouts/BaseLayout.astro \
        src/pages/blog/[...page].astro \
        src/pages/categorias/[category]/[...page].astro
git commit -m "seo: canonical explícito en páginas paginadas > 1 apunta a página raíz"
```

---

## Verificación Final

```bash
npm run build

# og:image:alt presente en la home
grep "og:image:alt" dist/index.html

# twitter:image:alt presente
grep "twitter:image:alt" dist/index.html

# Canonical en blog page 2 apunta a /blog/ (si existe)
grep "canonical" dist/blog/2/index.html 2>/dev/null

# Lint limpio
npm run lint
```
