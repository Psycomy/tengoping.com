---
import type { GetStaticPaths } from 'astro';
import BaseLayout from '@layouts/BaseLayout.astro';
import ArticleCard from '@components/ArticleCard.astro';
import { getCollection } from 'astro:content';
import authors from '@data/authors.json';

export const getStaticPaths = (async () => {
  const posts = await getCollection('blog', ({ data }) => !data.draft);
  return authors.map((author) => ({
    params: { id: author.id },
    props: {
      author,
      posts: posts
        .filter((p) => p.data.author === author.id)
        .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()),
    },
  }));
}) satisfies GetStaticPaths;

const { author, posts } = Astro.props;
---

<BaseLayout title={author.name} description={author.bio}>
  <section class="container page-section">
    <div class="author-card">
      <div class="author-avatar-wrapper">
        <img src={author.avatar} alt={author.name} class="author-avatar" />
      </div>
      <div class="author-content">
        <h1 class="author-name">{author.name}</h1>
        <p class="author-role">{author.bioShort}</p>
        <p class="author-bio">{author.bio}</p>
        <div class="author-meta">
          <span class="meta-stat">{posts.length} artículos</span>
          {
            (() => {
              const s = author.social as { twitter?: string; github?: string; linkedin?: string };
              return (
                <div class="author-social">
                  {s.twitter && (
                    <a href={s.twitter} target="_blank" rel="noopener noreferrer">
                      [twitter]
                    </a>
                  )}
                  {s.github && (
                    <a href={s.github} target="_blank" rel="noopener noreferrer">
                      [github]
                    </a>
                  )}
                  {s.linkedin && (
                    <a href={s.linkedin} target="_blank" rel="noopener noreferrer">
                      [linkedin]
                    </a>
                  )}
                </div>
              );
            })()
          }
        </div>
      </div>
    </div>

    <h2 class="posts-heading">Artículos de {author.name} ({posts.length})</h2>
    <div class="posts-grid">
      {posts.map((post) => <ArticleCard post={post} />)}
    </div>
  </section>
</BaseLayout>

<style>
  .page-section {
    padding: 3rem 0 4rem;
  }

  .author-card {
    display: flex;
    flex-direction: row;
    overflow: hidden;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    margin-bottom: 3rem;
  }

  .author-avatar-wrapper {
    display: block;
    overflow: hidden;
    flex: 0 0 300px;
    min-height: 200px;
  }

  .author-avatar {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-right: 1px solid var(--color-border);
  }

  .author-content {
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 2rem;
    flex: 1;
    min-height: 200px;
  }

  .author-name {
    margin: 0 0 0.25rem;
    font-size: 1.75rem;
    font-weight: 700;
    line-height: 1.3;
  }

  .author-role {
    color: var(--color-primary);
    font-weight: 600;
    font-size: 0.9375rem;
    margin-bottom: 1rem;
  }

  .author-bio {
    margin: 0 0 1.25rem;
    font-size: 0.875rem;
    line-height: 1.7;
    color: var(--color-text-secondary);
  }

  .author-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-top: auto;
    padding-top: 1rem;
    border-top: 1px solid var(--color-border);
    width: 100%;
    flex-wrap: wrap;
  }

  .meta-stat {
    color: var(--color-accent);
    font-size: 0.8125rem;
    font-weight: 600;
  }

  .author-social {
    display: flex;
    gap: 0.75rem;
  }
  .author-social a {
    color: var(--color-text-muted);
    text-decoration: none;
    font-size: 0.8125rem;
    font-weight: 500;
    transition: color 0.2s;
  }
  .author-social a:hover {
    color: var(--color-primary);
  }

  .posts-heading {
    margin-bottom: 2rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--color-border);
  }

  .posts-grid {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }

  @media (max-width: 768px) {
    .author-card {
      flex-direction: column;
    }
    .author-avatar-wrapper {
      flex: none;
      aspect-ratio: 16/9;
      min-height: auto;
    }
    .author-avatar {
      border-right: none;
      border-bottom: 1px solid var(--color-border);
    }
  }
</style>
