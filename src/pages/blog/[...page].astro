---
import type { GetStaticPaths } from 'astro';
import BaseLayout from '@layouts/BaseLayout.astro';
import ArticleCard from '@components/ArticleCard.astro';
import Pagination from '@components/Pagination.astro';
import { getCollection } from 'astro:content';
import { getUniqueCategories, slugify } from '@utils/helpers';
import site from '@data/site.json';

export const getStaticPaths = (async ({ paginate }) => {
  const posts = (await getCollection('blog', ({ data }) => !data.draft))
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
  return paginate(posts, { pageSize: site.postsPerPage });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const categories = getUniqueCategories(allPosts);
---

<BaseLayout title="Blog" description="Todos los artículos del blog">
  <section class="blog-page container">
    <h1>Blog</h1>

    <nav class="category-filter" aria-label="Filtrar por categoría">
      <a href="/blog" class="badge badge-category">Todas</a>
      {categories.map((cat) => (
        <a href={`/categorias/${slugify(cat)}`} class="badge badge-tag">{cat}</a>
      ))}
    </nav>

    <div class="posts-grid">
      {page.data.map((post) => (
        <ArticleCard post={post} />
      ))}
    </div>

    <Pagination
      url={{ prev: page.url.prev, next: page.url.next, current: page.url.current }}
      currentPage={page.currentPage}
      lastPage={page.lastPage}
    />
  </section>
</BaseLayout>

<style>
  .blog-page {
    padding: 3rem 0 4rem;
  }

  .blog-page h1 {
    text-align: center;
    margin-bottom: 2rem;
  }

  .category-filter {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 2.5rem;
  }

  .posts-grid {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
</style>
